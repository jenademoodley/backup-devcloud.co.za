<!DOCTYPE html><html lang="en-za"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Why is my EFS slow? - DevCloud</title><meta name="description" content=" If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS appears to be slower than&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://devcloud.co.za/improving-efs-performance-part-1/"><link rel="alternate" type="application/atom+xml" href="https://devcloud.co.za/feed.xml"><link rel="alternate" type="application/json" href="https://devcloud.co.za/feed.json"><meta property="og:title" content="Why is my EFS slow?"><meta property="og:image" content="https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg"><meta property="og:site_name" content="DevCloud"><meta property="og:description" content=" If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS appears to be slower than&hellip;"><meta property="og:url" content="https://devcloud.co.za/improving-efs-performance-part-1/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://devcloud.co.za/media/website/cloud-icon-2.png" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--post-entry-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://devcloud.co.za/assets/css/style.css?v=359625d231b3348c4c1f3090ac60cb1f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://devcloud.co.za/improving-efs-performance-part-1/"},"headline":"Why is my EFS slow?","datePublished":"2020-07-16T23:10","dateModified":"2022-02-07T00:11","image":{"@type":"ImageObject","url":"https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg","height":624,"width":1200},"description":" If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS appears to be slower than&hellip;","author":{"@type":"Person","name":"Jenade Moodley"},"publisher":{"@type":"Organization","name":"Jenade Moodley"}}</script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://devcloud.co.za/">DevCloud</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">AWS Cloud</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">EC2</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/diagnosing-ec2-performance-issues/" target="_self">Diagnosing EC2 Performance Issues</a></li></ul></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">EFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active"><a href="https://devcloud.co.za/improving-efs-performance-part-1/" target="_self">Why is my EFS slow?</a></li><li><a href="https://devcloud.co.za/improving-efs-performance-part-2/" target="_self">Improving EFS Performance</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ECR</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/how-does-the-docker-client-authenticate-to-ecr/" target="_self">How does the Docker client authenticate to ECR?</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ECS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/ecs-dynamic-port-mapping/" target="_self">Dynamic Port Mapping</a></li><li><a href="https://devcloud.co.za/ecs-monitor-container-level-cpu-and-memory-using-docker-stats-and-cloudwatch-metrics/" target="_self">Container-level monitoring with Docker stats</a></li><li><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" target="_self">Storing Stopped ECS Task Details</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ELB</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" target="_self">ALB - Least Outstanding Requests</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Linux</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">NFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/the-nfs-buffer-cache/" target="_self">NFS Buffer Cache</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">About</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://devcloud.co.za/about-me/" target="_self">About Me</a></li><li><a href="https://devcloud.co.za/about-this-website/" target="_self">About this Site</a></li></ul></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2022-02-10T23:44">February 10, 2022</time></div><div class="infobar__search"><form action="https://devcloud.co.za/search.html"><input type="search" name="q" placeholder="search..." aria-label="Search input"> <button type="submit" aria-label="Submit"><svg role="presentation" focusable="false" width="15px" height="14px"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><figure class="post__featured-image"><img src="https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg" srcset="https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xs.jpg 300w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-sm.jpg 480w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-md.jpg 768w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-lg.jpg 1024w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xl.jpg 1360w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="624" width="1200" alt=""></figure><header class="u-header post__header"><h1>Why is my EFS slow?</h1><div class="u-header__meta u-small"><img src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="eager" class="u-header__avatar" alt="Jenade Moodley" height="1439" width="1440"><div><a href="https://devcloud.co.za/authors/jenade-moodley/" title="Jenade Moodley">Jenade Moodley</a> <time datetime="2020-07-16T23:10">July 16, 2020 </time><a href="https://devcloud.co.za/blog/efs/" class="u-tag u-tag--1">EFS</a></div></div></header><div class="post__entry u-inner"><p>If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS appears to be slower than using regular disks. This slowness is not caused deliberately, rather it is due to the nature of EFS.&nbsp;</p><p>Using EFS without being aware of it's architecture and limitations can catch you unawares, however, by understanding how EFS works and the nature of your application, it is possible to boost the performance of your application using EFS (notice I said application performance and not EFS performance.)</p><h2 id="efs-architecture">EFS Architecture</h2><p>Straight from AWS' documentation, EFS is a distributed file system which is designed to be accessed by thousands of clients simultaneously, provide redundant and highly available storage across multiple availability zones, and provide low latency per-file operation. The latter of these claims otherwise towards the slowness experienced, however the key-words to remember is "per-file operation". It is an NFS file system, and is designed to be accessed via the NFS protocol. Supported versions of the protocol are NFS version 4, and NFS version 4.1 (preferred).</p><p>EFS manages all file storage infrastructure for you, and you only pay for the storage that you use. You do not have to provision any servers or instances, nor do you have to manage any storage or disks. It also guarantees "close-to-open" data consistency and supports POSIX permissions.</p><h2 id="understanding-perfile-operation-latencynbsp">Understanding "per-file operation" latency&nbsp;</h2><p>To understand why per-file operation latency can induce slowness, we first need to understand how the operating system works with files in general. EFS, at present, can only be accessed by Linux-based clients, and every single component of Linux, be it an application or configuration, consists of files. In short, every action on your Linux operating system requires accessing a file.</p><p>Unpacking that analogy, there are only two options which are applicable to the use of files; reading, and writing to a file. From the operating system's point of view, either of these actions is interpreted as an "operation", and there are appropriate read and write operations available as the operating system would need to perform different actions for these operations. This is unpacked further here (coming soon).</p><p>When reading or writing to a file, the operating system needs to first obtain the metadata for the file, which contains various information about the file including the inode of the file, the permissions to determine if the file is accessible by the user or application performing the operation, as well as the block size and IO block (location on the disk) for the actual data on the file. If the user or application has sufficient permissions to access the file, the operating system would then access the contents of the file from the disk.</p><p>Coming back to EFS, we know that EFS uses the NFS protocol to run file operations. What you may not know, is that NFS is not too efficient with handling metadata, which is necessary for all file operations. To briefly explain, your file would be located within a directory, such as the root EFS directory or several directories within the EFS. When trying to access a file, the NFS protocol will recursively check each directory to determine if the user has sufficient permissions to access each directory, before finally arriving at the specified file. As you are connecting to the EFS over a network, each of these checks is a Remote Procedure Call (RPC). As these checks occur over a network, while these checks occur very fast, they are much slower when compared to directly attached storage options. A deeper overview of the NFS protocol sequence is explained <a href="http://www.eventhelix.com/realtimemantra/networking/NFS_Protocol_Sequence_Diagram.pdf" target="_blank">here</a>.</p><h2 id="whats-next">What's next?</h2><p>Now that we understand what causes latency with the EFS, we can go ahead and start looking methods for improving the performance of the applications which use the EFS. This is discussed in the <a href="https://devcloud.co.za/improving-efs-performance-part-2/">second part of this blog post</a>.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on February 7, 2022</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F&amp;via=DevCloud&amp;text=Why%20is%20my%20EFS%20slow%3F" class="js-share twitter" title="Share with Twitter" rel="nofollow noopener noreferrer" aria-label="Share with Twitter"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F&amp;media=https%3A%2F%2Fdevcloud.co.za%2Fmedia%2Fposts%2F6%2FAWS_EFS-system_DIMq8h4.jpg&amp;description=Why%20is%20my%20EFS%20slow%3F" class="js-share pinterest" title="Share with Pinterest" rel="nofollow noopener noreferrer" aria-label="Share with Pinterest"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://wa.me/?text=Why%20is%20my%20EFS%20slow%3F https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F" class="js-share whatsapp" rel="nofollow noopener noreferrer" title="Share with WhatsApp" aria-label="Share with WhatsApp"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#whatsapp"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow noopener noreferrer" aria-label="Share with LinkedIn"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#linkedin"/></svg></a></div></aside><footer class="post__footer"><ul class="post__tag box"><li><a href="https://devcloud.co.za/blog/aws/" class="u-tag u-tag--1" title="AWS">AWS</a></li><li><a href="https://devcloud.co.za/blog/efs/" class="u-tag u-tag--1" title="EFS">EFS</a></li><li><a href="https://devcloud.co.za/blog/nfs/" class="u-tag u-tag--1" title="NFS">NFS</a></li></ul><div class="post__bio box"><img class="u-author__avatar" src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="lazy" alt="Jenade Moodley" height="1439" width="1440"><div><h4 class="h6"><a href="https://devcloud.co.za/authors/jenade-moodley/" title="Jenade Moodley">Jenade Moodley</a></h4><p>Hi there. I&#x27;m a Cloud Engineer, currently working at AWS. I have a background in Computer Science, and gained reputable experience with Linux, Containers, and Cloud Architecture</p></div></div><nav class="post__nav box"><div class="post__nav__next"><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Improving EFS Performance</h5></div><img src="https://devcloud.co.za/media/posts/7/responsive/AWS_EFS-system_DIMq8h4-xs.jpg" loading="lazy" alt="" height="624" width="1200"></a></div></nav></footer></article><div class="comments box"><h3 class="box__title">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = 'https://devcloud.co.za/improving-efs-performance-part-1/';
                    this.page.identifier = '6';
                };
                var disqus_element_to_check = document.getElementById('disqus_thread');
            
                if ('IntersectionObserver' in window) {
                    var iObserver = new IntersectionObserver(
                        (entries, observer) => {
                            entries.forEach(entry => {
                                if (entry.intersectionRatio >= 0.1) {
                                    (function () {
                                        var d = document, s = d.createElement('script');
                                        s.src = 'https://'+'devcloud-co-za'.trim()+'.disqus.com/embed.js';
                                        s.setAttribute('data-timestamp', +new Date());
                                        (d.head || d.body).appendChild(s);
                                    })();
                                    observer.unobserve(entry.target);
                                }
                            });
                        },
                        {
                            threshold: [0, 1]
                        }
                    );
            
                    iObserver.observe(disqus_element_to_check);
                } else {
                    (function () {
                        var d = document, s = d.createElement('script');
                        s.src = 'https://'+'devcloud-co-za'.trim()+'.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                }</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></main><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured</h3><ul class="featured__container"><li class="featured__item"><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/14/responsive/df8a5c58-68a2-4f99-bc4d-3e080890d13a-xs.jpg" class="lazyload" loading="lazy" alt="" height="619" width="619"></a><div><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" class="featured__title">How to store ECS Stopped Task Details</a> <time class="u-small" datetime="2020-10-08T16:43">October 8, 2020</time></div></li><li class="featured__item"><div><a href="https://devcloud.co.za/the-nfs-buffer-cache/" class="featured__title">The NFS Buffer Cache</a> <time class="u-small" datetime="2020-07-25T16:44">July 25, 2020</time></div></li><li class="featured__item"><div><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" class="featured__title">Understanding Least Outstanding Requests ALB Load Balancing Algorithm</a> <time class="u-small" datetime="2020-07-24T00:36">July 24, 2020</time></div></li><li class="featured__item"><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/7/responsive/AWS_EFS-system_DIMq8h4-xs.jpg" class="lazyload" loading="lazy" alt="" height="624" width="624"></a><div><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="featured__title">Improving EFS Performance</a> <time class="u-small" datetime="2020-07-17T23:57">July 17, 2020</time></div></li><li class="featured__item"><a href="https://devcloud.co.za/improving-efs-performance-part-1/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xs.jpg" class="lazyload" loading="lazy" alt="" height="624" width="624"></a><div><a href="https://devcloud.co.za/improving-efs-performance-part-1/" class="featured__title">Why is my EFS slow?</a> <time class="u-small" datetime="2020-07-16T23:10">July 16, 2020</time></div></li></ul></section><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><a href="https://devcloud.co.za/authors/jenade-moodley/" class="authors__image-link"><img src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="lazy" alt="Jenade Moodley" height="1439" width="1440"></a><div><a href="https://devcloud.co.za/authors/jenade-moodley/" class="authors__title">Jenade Moodley</a> <span class="u-small">Post: 11</span></div></li></ul></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://devcloud.co.za/blog/alb/">ALB</a> <span class="u-small">(2)</span></li><li><a href="https://devcloud.co.za/blog/aws/">AWS</a> <span class="u-small">(6)</span></li><li><a href="https://devcloud.co.za/blog/docker/">Docker</a> <span class="u-small">(2)</span></li><li><a href="https://devcloud.co.za/blog/ec2/">EC2</a> <span class="u-small">(1)</span></li><li><a href="https://devcloud.co.za/blog/ecr/">ECR</a> <span class="u-small">(1)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://devcloud.co.za/">DevCloud</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright"><p>Powered by Publii</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://devcloud.co.za/assets/js/scripts.min.js?v=bb66f1d815180573784f8434c8f0bf78"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>