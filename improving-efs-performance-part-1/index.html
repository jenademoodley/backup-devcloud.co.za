<!DOCTYPE html><html lang="en-za"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Improving EFS Performance (Part 1) - DevCloud</title><meta name="description" content=" Why is my EFS slow? If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://devcloud.co.za/improving-efs-performance-part-1/"><link rel="alternate" type="application/atom+xml" href="https://devcloud.co.za/feed.xml"><link rel="alternate" type="application/json" href="https://devcloud.co.za/feed.json"><meta property="og:title" content="Improving EFS Performance (Part 1)"><meta property="og:image" content="https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg"><meta property="og:site_name" content="DevCloud"><meta property="og:description" content=" Why is my EFS slow? If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS&hellip;"><meta property="og:url" content="https://devcloud.co.za/improving-efs-performance-part-1/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://devcloud.co.za/media/website/cloud-icon-2.png" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://devcloud.co.za/assets/css/style.css?v=c37594acf579eddd689835749263c87b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://devcloud.co.za/improving-efs-performance-part-1/"},"headline":"Improving EFS Performance (Part 1)","datePublished":"2020-07-16T23:10","dateModified":"2020-08-12T10:41","image":{"@type":"ImageObject","url":"https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg","height":624,"width":1200},"description":" Why is my EFS slow? If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS&hellip;","author":{"@type":"Person","name":"Jenade Moodley"},"publisher":{"@type":"Organization","name":"Jenade Moodley"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://devcloud.co.za/">DevCloud</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">AWS Cloud</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">EFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active"><a href="https://devcloud.co.za/improving-efs-performance-part-1/" target="_self">Improving EFS Performance</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ECS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/ecs-dynamic-port-mapping/" target="_self">Dynamic Port Mapping</a></li><li><a href="https://devcloud.co.za/ecs-monitor-container-level-cpu-and-memory-using-docker-stats-and-cloudwatch-metrics/" target="_self">Container-level monitoring with Docker stats</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ELB</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" target="_self">ALB - Least Outstanding Requests</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Linux</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">NFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/the-nfs-buffer-cache/" target="_self">NFS Buffer Cache</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">About</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://devcloud.co.za/about-me/" target="_self">About Me</a></li><li><a href="https://devcloud.co.za/about-this-website/" target="_self">About this Site</a></li></ul></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://devcloud.co.za/media/posts/6/AWS_EFS-system_DIMq8h4.jpg" srcset="https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xs.jpg 300w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-sm.jpg 480w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-md.jpg 768w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-lg.jpg 1024w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xl.jpg 1360w, https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="624" width="1200" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2020-07-16T23:10">July 16, 2020</time></div><h1>Improving EFS Performance (Part 1)</h1><div class="post__meta post__meta--author"><img src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="eager" alt="Jenade Moodley" class="post__author-thumb"> <a href="https://devcloud.co.za/authors/jenade-moodley/" class="feed__author invert">Jenade Moodley</a></div></div></header></div><div class="wrapper post__entry"><h2 id="why-is-my-efs-slow">Why is my EFS slow?</h2><p>If you have started using EFS as the main root storage for your application such as your WordPress website, or a common storage layer for your containerized applications, you may notice that the performance obtained when using the EFS appears to be slower than using regular disks. This slowness is not caused deliberately, rather it is due to the nature of EFS.&nbsp;</p><p>Using EFS without being aware of it's architecture and limitations can catch you unawares, however, by understanding how EFS works and the nature of your application, it is possible to boost the performance of your application using EFS (notice I said application performance and not EFS performance.)</p><h2 id="efs-architecture">EFS Architecture</h2><p>Straight from AWS' documentation, EFS is a distributed file system which is designed to be accessed by thousands of clients simultaneously, provide redundant and highly available storage across multiple availability zones, and provide low latency per-file operation. The latter of these claims otherwise towards the slowness experienced, however the key-words to remember is "per-file operation". It is an NFS file system, and is designed to be accessed via the NFS protocol. Supported versions of the protocol are NFS version 4, and NFS version 4.1 (preferred).</p><p>EFS manages all file storage infrastructure for you, and you only pay for the storage that you use. You do not have to provision any servers or instances, nor do you have to manage any storage or disks. It also guarantees "close-to-open" data consistency and supports POSIX permissions.</p><h2 id="understanding-perfile-operation-latencynbsp">Understanding "per-file operation" latency&nbsp;</h2><p>To understand why per-file operation latency can induce slowness, we first need to understand how the operating system works with files in general. EFS, at present, can only be accessed by Linux-based clients, and every single component of Linux, be it an application or configuration, consists of files. In short, every action on your Linux operating system requires accessing a file.</p><p>Unpacking that analogy, there are only two options which are applicable to the use of files; reading, and writing to a file. From the operating system's point of view, either of these actions is interpreted as an "operation", and there are appropriate read and write operations available as the operating system would need to perform different actions for these operations. This is unpacked further here (coming soon).</p><p>When reading or writing to a file, the operating system needs to first obtain the metadata for the file, which contains various information about the file including the inode of the file, the permissions to determine if the file is accessible by the user or application performing the operation, as well as the block size and IO block (location on the disk) for the actual data on the file. If the user or application has sufficient permissions to access the file, the operating system would then access the contents of the file from the disk.</p><p>Coming back to EFS, we know that EFS uses the NFS protocol to run file operations. What you may not know, is that NFS is not too efficient with handling metadata, which is necessary for all file operations. To briefly explain, your file would be located within a directory, such as the root EFS directory or several directories within the EFS. When trying to access a file, the NFS protocol will recursively check each directory to determine if the user has sufficient permissions to access each directory, before finally arriving at the specified file. As you are connecting to the EFS over a network, each of these checks is a Remote Procedure Call (RPC). As these checks occur over a network, while these checks occur very fast, they are much slower when compared to directly attached storage options. A deeper overview of the NFS protocol sequence is explained <a href="http://www.eventhelix.com/realtimemantra/networking/NFS_Protocol_Sequence_Diagram.pdf" target="_blank">here</a>.</p><h2 id="whats-next">What's next?</h2><p>Now that we understand what causes latency with the EFS, we can go ahead and start looking methods for improving the performance of the applications which use the EFS. This is discussed in the <a href="https://devcloud.co.za/improving-efs-performance-part-2/">second part of this blog post</a>.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on August 12, 2020</p><ul class="post__tag"><li><a href="https://devcloud.co.za/blog/aws/">AWS</a></li><li><a href="https://devcloud.co.za/blog/efs/">EFS</a></li><li><a href="https://devcloud.co.za/blog/nfs/">NFS</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F&amp;via=DevCloud&amp;text=Improving%20EFS%20Performance%20(Part%201)" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F&amp;media=https%3A%2F%2Fdevcloud.co.za%2Fmedia%2Fposts%2F6%2FAWS_EFS-system_DIMq8h4.jpg&amp;description=Improving%20EFS%20Performance%20(Part%201)" class="js-share pinterest" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#pinterest"/></svg> <span>Pinterest</span> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F&amp;title=Improving%20EFS%20Performance%20(Part%201)" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=Improving%20EFS%20Performance%20(Part%201) https%3A%2F%2Fdevcloud.co.za%2Fimproving-efs-performance-part-1%2F" class="js-share whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div><div class="post__bio bio"><img class="bio__avatar" src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="lazy" alt="Jenade Moodley"><div class="bio__info"><h3 class="bio__name"><a href="https://devcloud.co.za/authors/jenade-moodley/" class="invert" rel="author">Jenade Moodley</a></h3><p>Hi there. I&#x27;m a Cloud Support Engineer, currently working at AWS. I have a background in Computer Science, and gained reputable experience with Linux, Containers, and Cloud Architecture</p></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-next"><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="invert post__nav-link" rel="next"><span>Next</span> Improving EFS Performance (Part 2) </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2020-07-17T23:57" class="feed__date">July 17, 2020</time></div><h3 class="h1"><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="invert">Improving EFS Performance (Part 2)</a></h3></article></div></div><div class="post__comments"><div class="wrapper"><h2 class="h5">Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://devcloud.co.za/improving-efs-performance-part-1/';
               		this.page.identifier = '6';
                   };
               
                   var disqus_loaded = false;
               
                   function publiiLoadDisqus() {
                       if(disqus_loaded) {
                           return false;
                       }
               
                       var top = document.getElementById('disqus_thread').offsetTop;
               
                       if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                           disqus_loaded = true;
               
                           (function () {
                               var d = document, s = d.createElement('script');
                               s.src = 'https://devcloud-co-za.disqus.com/embed.js';
                               s.setAttribute('data-timestamp', +new Date());
                               (d.head || d.body).appendChild(s);
                           })();
                       }
                   }
               
                   publiiLoadDisqus();
               
                   window.onscroll = function() {
                       publiiLoadDisqus();
                   };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noreferrer">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__copyright"><p>Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii Static CMS</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://devcloud.co.za/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>