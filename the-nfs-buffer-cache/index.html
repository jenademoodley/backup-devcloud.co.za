<!DOCTYPE html><html lang="en-za"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>The NFS Buffer Cache - DevCloud</title><meta name="description" content="If you are using an NFS compatible Distributed File System (such as a Samba server or EFS), you may notice a slight delay when writing files to the file system, more specifically, when you create a new file from one of the NFS clients, it&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','G-8FC1RDBQN5');</script><link rel="canonical" href="https://devcloud.co.za/the-nfs-buffer-cache/"><link rel="alternate" type="application/atom+xml" href="https://devcloud.co.za/feed.xml"><link rel="alternate" type="application/json" href="https://devcloud.co.za/feed.json"><meta property="og:title" content="The NFS Buffer Cache"><meta property="og:site_name" content="DevCloud"><meta property="og:description" content="If you are using an NFS compatible Distributed File System (such as a Samba server or EFS), you may notice a slight delay when writing files to the file system, more specifically, when you create a new file from one of the NFS clients, it&hellip;"><meta property="og:url" content="https://devcloud.co.za/the-nfs-buffer-cache/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://devcloud.co.za/media/website/cloud-icon-2.png" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--post-entry-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://devcloud.co.za/assets/css/style.css?v=f10d6fac6ca8d5365d369c06e26eaf8b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://devcloud.co.za/the-nfs-buffer-cache/"},"headline":"The NFS Buffer Cache","datePublished":"2020-07-25T16:44","dateModified":"2020-08-12T10:43","description":"If you are using an NFS compatible Distributed File System (such as a Samba server or EFS), you may notice a slight delay when writing files to the file system, more specifically, when you create a new file from one of the NFS clients, it&hellip;","author":{"@type":"Person","name":"Jenade Moodley","url":"https://devcloud.co.za/authors/jenade-moodley/"},"publisher":{"@type":"Organization","name":"Jenade Moodley"}}</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-8FC1RDBQN5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://devcloud.co.za/">DevCloud</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">AWS Cloud</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">EC2</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/diagnosing-ec2-performance-issues/" target="_self">Diagnosing EC2 Performance Issues</a></li><li><a href="https://devcloud.co.za/how-to-configure-cgroupv2-on-amazon-linux-2/" target="_self">Enabling cgroupv2 on Amazon Linux 2</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">EFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/improving-efs-performance-part-1/" target="_self">Why is my EFS slow?</a></li><li><a href="https://devcloud.co.za/improving-efs-performance-part-2/" target="_self">Improving EFS Performance</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ECR</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/how-does-the-docker-client-authenticate-to-ecr/" target="_self">How does the Docker client authenticate to ECR?</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ECS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/ecs-dynamic-port-mapping/" target="_self">Dynamic Port Mapping</a></li><li><a href="https://devcloud.co.za/ecs-monitor-container-level-cpu-and-memory-using-docker-stats-and-cloudwatch-metrics/" target="_self">Container-level monitoring with Docker stats</a></li><li><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" target="_self">Storing Stopped ECS Task Details</a></li><li><a href="https://devcloud.co.za/how-to-use-arm-based-gpu-ec2-instances-as-ecs-container-instances/" target="_self">ARM-based GPU container instances</a></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">ELB</span><ul class="navbar__submenu level-3" aria-hidden="true"><li><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" target="_self">ALB - Least Outstanding Requests</a></li></ul></li></ul></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Linux</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">NFS</span><ul class="navbar__submenu level-3" aria-hidden="true"><li class="active"><a href="https://devcloud.co.za/the-nfs-buffer-cache/" target="_self">NFS Buffer Cache</a></li></ul></li></ul></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">About</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://devcloud.co.za/about-me/" target="_self">About Me</a></li><li><a href="https://devcloud.co.za/about-this-website/" target="_self">About this Site</a></li></ul></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2024-01-11T09:27">January 11, 2024</time></div><div class="infobar__search"><form action="https://devcloud.co.za/search.html"><input type="search" name="q" placeholder="search..." aria-label="Search input"> <button type="submit" aria-label="Submit"><svg role="presentation" focusable="false" width="15px" height="14px"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><header class="u-header post__header"><h1>The NFS Buffer Cache</h1><div class="u-header__meta u-small"><img src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="eager" class="u-header__avatar" alt="Jenade Moodley" height="1439" width="1440"><div><a href="https://devcloud.co.za/authors/jenade-moodley/" title="Jenade Moodley">Jenade Moodley</a> <time datetime="2020-07-25T16:44">July 25, 2020 </time><a href="https://devcloud.co.za/blog/nfs/" class="u-tag u-tag--1">NFS</a></div></div></header><div class="post__entry u-inner"><p>If you are using an NFS compatible Distributed File System (such as a Samba server or EFS), you may notice a slight delay when writing files to the file system, more specifically, when you create a new file from one of the NFS clients, it may take a couple of seconds longer to appear on another client, even though it is already available on the original client.<br></p><p>This behaviour can be explained by the NFS buffer cache. By default, when you are writing data to a file in Linux, it is first written in memory. This is appropriately called a buffer, i.e. it can be described as a smaller and faster storage area, which sits in front of the actual storage device. This is to improve performance as memory is much faster than a hard disk or solid state drive. The same is true for NFS, where writes are first written to the NFS buffer, before being flushed (or synced) to the NFS storage. This improves performance on the client performing the writes as the clients do not have to wait for the data to be synced to the NFS disk on every write, allowing more writes to be processed.</p><p>However, if your application is heavily dependent on consistency, i.e. it needs to be available on another client as soon as the write is made, this buffer will not be ideal for you. Instead, you can then opt-in to allow writes to be written directly to the server, bypassing the cache. This can be controlled by the <code>sync</code> NFS mount option. By default, the NFS client will use the <code>async</code> mount option unless specified otherwise. <code>async</code> refers to asynchronous, where data is flushed asynchronously to the main server. If you switch to using the <code>sync</code> mount option, data will be flushed to the server immediately, which allows for greater consistency but at a great performance cost. Referring to the <a href="https://linux.die.net/man/5/nfs" target="_blank">NFS man pages</a>:</p><pre class="line-numbers language-bash"><code>The sync mount option
    The NFS client treats the sync mount option differently than some other file systems (refer to mount(8) for a description of the generic sync and async mount options). If neither sync nor async is specified (or if the async option is specified), the NFS client delays sending application writes to the server until any of these events occur:

       Memory pressure forces reclamation of system memory resources.

       An application flushes file data explicitly with sync(2), msync(2), or fsync(3).

       An application closes a file with close(2).

       The file is locked/unlocked via fcntl(2).

    In other words, under normal circumstances, data written by an application may not immediately appear on the server that hosts the file.

    If the sync option is specified on a mount point, any system call that writes data to files on that mount point causes that data to be flushed to the server before the system call returns control to user space. This provides greater data cache coherence among clients, but at a significant performance cost.

    Applications can use the O_SYNC open flag to force application writes to individual files to go to the server immediately without the use of the sync mount option.</code></pre><p>Like all NFS mount options, the <code>sync</code> mount option is specified when mounting the file system. As previously mentioned, it should be used with caution as it can cause significant performance impact for write operations.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on August 12, 2020</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevcloud.co.za%2Fthe-nfs-buffer-cache%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fdevcloud.co.za%2Fthe-nfs-buffer-cache%2F&amp;via=DevCloud&amp;text=The%20NFS%20Buffer%20Cache" class="js-share twitter" title="Share with Twitter" rel="nofollow noopener noreferrer" aria-label="Share with Twitter"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fdevcloud.co.za%2Fthe-nfs-buffer-cache%2F&amp;media=undefined&amp;description=The%20NFS%20Buffer%20Cache" class="js-share pinterest" title="Share with Pinterest" rel="nofollow noopener noreferrer" aria-label="Share with Pinterest"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://wa.me/?text=The%20NFS%20Buffer%20Cache https%3A%2F%2Fdevcloud.co.za%2Fthe-nfs-buffer-cache%2F" class="js-share whatsapp" rel="nofollow noopener noreferrer" title="Share with WhatsApp" aria-label="Share with WhatsApp"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#whatsapp"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fdevcloud.co.za%2Fthe-nfs-buffer-cache%2F" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow noopener noreferrer" aria-label="Share with LinkedIn"><svg class="u-icon"><use xlink:href="https://devcloud.co.za/assets/svg/svg-map.svg#linkedin"/></svg></a></div></aside><footer class="post__footer"><ul class="post__tag box"><li><a href="https://devcloud.co.za/blog/linux/" class="u-tag u-tag--1" title="Linux">Linux</a></li><li><a href="https://devcloud.co.za/blog/nfs/" class="u-tag u-tag--1" title="NFS">NFS</a></li></ul><div class="post__bio box"><img class="u-author__avatar" src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="lazy" alt="Jenade Moodley" height="1439" width="1440"><div><h4 class="h6"><a href="https://devcloud.co.za/authors/jenade-moodley/" title="Jenade Moodley">Jenade Moodley</a></h4><p>Hi there. I&#x27;m a Cloud Engineer, currently working at AWS. I have a background in Computer Science, and gained reputable experience with Linux, Containers, and Cloud Architecture</p></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" class="post__nav__link" rel="prev"><div class="u-small">Previous Post<h5>Understanding Least Outstanding Requests ALB Load Balancing Algorithm</h5></div></a></div><div class="post__nav__next"><a href="https://devcloud.co.za/about-me/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>About Me</h5></div><img src="https://devcloud.co.za/media/posts/12/responsive/wificoffeelaptop-1280x720-2-xs.jpg" loading="lazy" alt="" height="720" width="1280"></a></div></nav></footer></article><div class="comments box"><h3 class="box__title">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = 'https://devcloud.co.za/the-nfs-buffer-cache/';
                    this.page.identifier = '11';
                };
                var disqus_element_to_check = document.getElementById('disqus_thread');
            
                if ('IntersectionObserver' in window) {
                    var iObserver = new IntersectionObserver(
                        (entries, observer) => {
                            entries.forEach(entry => {
                                if (entry.intersectionRatio >= 0.1) {
                                    (function () {
                                        var d = document, s = d.createElement('script');
                                        s.src = 'https://'+'devcloud-co-za'.trim()+'.disqus.com/embed.js';
                                        s.setAttribute('data-timestamp', +new Date());
                                        (d.head || d.body).appendChild(s);
                                    })();
                                    observer.unobserve(entry.target);
                                }
                            });
                        },
                        {
                            threshold: [0, 1]
                        }
                    );
            
                    iObserver.observe(disqus_element_to_check);
                } else {
                    (function () {
                        var d = document, s = d.createElement('script');
                        s.src = 'https://'+'devcloud-co-za'.trim()+'.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                }</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></main><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured</h3><ul class="featured__container"><li class="featured__item"><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/14/responsive/df8a5c58-68a2-4f99-bc4d-3e080890d13a-xs.jpg" class="lazyload" loading="lazy" alt="" height="619" width="619"></a><div><a href="https://devcloud.co.za/how-to-store-ecs-stopped-task-details/" class="featured__title">How to store ECS Stopped Task Details</a> <time class="u-small" datetime="2020-10-08T16:43">October 8, 2020</time></div></li><li class="featured__item"><div><a href="https://devcloud.co.za/the-nfs-buffer-cache/" class="featured__title">The NFS Buffer Cache</a> <time class="u-small" datetime="2020-07-25T16:44">July 25, 2020</time></div></li><li class="featured__item"><div><a href="https://devcloud.co.za/understanding-alb-least-outstanding-request/" class="featured__title">Understanding Least Outstanding Requests ALB Load Balancing Algorithm</a> <time class="u-small" datetime="2020-07-24T00:36">July 24, 2020</time></div></li><li class="featured__item"><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/7/responsive/AWS_EFS-system_DIMq8h4-xs.jpg" class="lazyload" loading="lazy" alt="" height="624" width="624"></a><div><a href="https://devcloud.co.za/improving-efs-performance-part-2/" class="featured__title">Improving EFS Performance</a> <time class="u-small" datetime="2020-07-17T23:57">July 17, 2020</time></div></li><li class="featured__item"><a href="https://devcloud.co.za/improving-efs-performance-part-1/" class="featured__image-link"><img src="https://devcloud.co.za/media/posts/6/responsive/AWS_EFS-system_DIMq8h4-xs.jpg" class="lazyload" loading="lazy" alt="" height="624" width="624"></a><div><a href="https://devcloud.co.za/improving-efs-performance-part-1/" class="featured__title">Why is my EFS slow?</a> <time class="u-small" datetime="2020-07-16T23:10">July 16, 2020</time></div></li></ul></section><section class="box u-ads"><h3 class="u-ads__title">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4779588160411156" crossorigin="anonymous"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4779588160411156" data-ad-slot="9127304575" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></section><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><a href="https://devcloud.co.za/authors/jenade-moodley/" class="authors__image-link"><img src="https://devcloud.co.za/media/website/39186496_1809180909164306_8750795900512632832_o.jpg" loading="lazy" alt="Jenade Moodley" height="1439" width="1440"></a><div><a href="https://devcloud.co.za/authors/jenade-moodley/" class="authors__title">Jenade Moodley</a> <span class="u-small">Post: 13</span></div></li></ul></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://devcloud.co.za/blog/alb/">ALB</a> <span class="u-small">(2)</span></li><li><a href="https://devcloud.co.za/blog/amazon-linux/">Amazon Linux</a> <span class="u-small">(1)</span></li><li><a href="https://devcloud.co.za/blog/test/">ARM64</a> <span class="u-small">(1)</span></li><li><a href="https://devcloud.co.za/blog/aws/">AWS</a> <span class="u-small">(7)</span></li><li><a href="https://devcloud.co.za/blog/docker/">Docker</a> <span class="u-small">(3)</span></li><li><a href="https://devcloud.co.za/blog/ec2/">EC2</a> <span class="u-small">(3)</span></li><li><a href="https://devcloud.co.za/blog/ecr/">ECR</a> <span class="u-small">(1)</span></li><li><a href="https://devcloud.co.za/blog/ecs/">ECS</a> <span class="u-small">(4)</span></li><li><a href="https://devcloud.co.za/blog/efs/">EFS</a> <span class="u-small">(2)</span></li><li><a href="https://devcloud.co.za/blog/arm/">GPU</a> <span class="u-small">(1)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://devcloud.co.za/">DevCloud</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright"><p>Powered by Publii</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://devcloud.co.za/assets/js/scripts.min.js?v=bb66f1d815180573784f8434c8f0bf78"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>